(self.modernJsonp=self.modernJsonp||[]).push([["8419"],{646811:function(e,t,n){n.r(t),n.d(t,{default:()=>l});let o={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"CloseupCommentButton_pin",selections:[{alias:null,args:null,kind:"ScalarField",name:"commentsDisabled",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isEligibleForPdp",storageKey:null},{args:null,kind:"FragmentSpread",name:"CommentsPopover_pin"}],type:"Pin",abstractKey:null};o.hash="526d11c356c26ad0b89c7990a8828b3a";let l=o},78316:function(e,t,n){n.r(t),n.d(t,{default:()=>b});var o,l=n(686659),i=n(667294);n(422578);var s=n(740097),r=n(689157),a=n(230201),c=n(183e3),d=n(24246),m=n(507006),u=n(935833),p=n(113759),h=n(49254),g=n(9065),f=n(785893);let v=(0,g.Z)(()=>n.e("30233").then(n.bind(n,490301)),void 0,e=>490301,"CommentsPopover",e=>["30233"]),C=(void 0!==o||(o=n(646811)).hash&&"526d11c356c26ad0b89c7990a8828b3a"!==o.hash&&console.error("The definition of 'CloseupCommentButton_pin' appears to have changed. Run `relay-compiler` to update the generated files to receive the expected data."),o);function b({inCommentsImprovedDropdownExp:e,inCommentsPopoverExp:t,isEligibleForAggregatedComments:n,pinKey:o,shouldShowCommentCount:g,totalCommentCount:b,viewParameter:_,viewType:w,scrollContainerRef:x}){(0,i.useEffect)(()=>{(0,l.Z)("CloseupCommentButton","/app/common/react/components/closeup/CloseupActionBar/CloseupCommentButton.tsx")},[]);let y=(0,d.Z)(),P=(0,h.t)(),B=(0,c.Z)(C,o),E=(0,r.Z)({showProductDetailPage:!!B.isEligibleForPdp}),{isCommentThreadExpanded:T,setIsCommentThreadExpanded:I,setIsCommentComposerFocused:R}=(0,p.x4)(),{logContextEvent:j}=(0,a.u)(),k=(0,i.useRef)(null),[D,F]=(0,i.useState)(!1),L=t&&T;(0,i.useEffect)(()=>{if(!E||!x)return;let e=document.getElementById("canonical-card");if(!e)return;let t=new IntersectionObserver(e=>{let t=e[0];t&&F(t.isIntersecting)},{root:x,threshold:0});return t.observe(e),setTimeout(()=>{let n=t.takeRecords();if(n.length>0&&n[0])F(n[0].isIntersecting);else{let t=x.getBoundingClientRect(),n=e.getBoundingClientRect();F(n.top>=t.top&&n.top<=t.bottom)}},100),()=>{t.disconnect()}},[E,x]);let Z=y._('Comments', 'Closeup.Comment.Icon', 'Icon for scrolling comments into view'),S=t=>{j({component:13464,element:2,event_type:10554,view_parameter:_,view_type:w}),(0,u.tj)("dweb.closeup_comment_button.community_view_intent",{tags:{experimentGroup:e?"improved_dropdown":"popover",clickSource:t}})},z=t=>{let n=document.getElementById("canonical-card"),o=document.querySelector('[data-test-id="canonical-card-tap-area"]');if(!n)return;if(E&&x){let l=x.getBoundingClientRect(),i=n.getBoundingClientRect().top-l.top,s=x.scrollTop+i-P,r=null,a=()=>{r&&clearTimeout(r),r=setTimeout(()=>{e&&(I?.(!0),S(t)),o&&o.focus(),x.removeEventListener("scroll",a)},100)};x.addEventListener("scroll",a,{passive:!0}),a(),x.scrollTo({top:s,behavior:"smooth"});return}let l=n.getBoundingClientRect().top+window.scrollY-P,i=null,s=()=>{i&&clearTimeout(i),i=setTimeout(()=>{e&&(I?.(!0),S(t)),o&&o.focus(),window.removeEventListener("scroll",s)},100)};window.addEventListener("scroll",s,{passive:!0}),s(),window.scrollTo({top:l,behavior:"smooth"})},K=e=>{if(t)T?I?.(!1):(I?.(!0),S(e));else if(E){let t=b>0;if(!D)return void z(e);T||!t||I?.(!0),S(e),R(!0)}else z(e)};return(0,f.jsxs)(s.xu,{role:"listitem",children:[L&&(0,f.jsx)(v,{anchorRef:k,pinKey:B,setIsOpen:I,viewParameter:_}),(0,f.jsxs)(s.kC,{alignItems:"center",direction:"row",children:[(0,f.jsx)(s.hU,{ref:k,accessibilityLabel:Z,disabled:!n||!!B.commentsDisabled,icon:"speech-outline",onClick:()=>K("icon"),selected:L,size:"lg",tooltip:{text:Z}}),g&&(0,f.jsx)(s.iP,{disabled:!n||!!B.commentsDisabled,onTap:()=>K("count"),children:(0,f.jsx)(s.xe,{weight:"bold",children:(0,f.jsx)(m.Z,{shortform:!0,shortformMaximumFractionDigits:1,value:b})})})]})]})}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/CloseupCommentButton-f75827bb754fbc01.mjs.map